---
export interface Props {
  title?: string;
  description?: string;
  lang?: string;
}

const { 
  title = "Sélim Aïdi | Data Copilot & Consultant Analytics",
  description = "Data Copilot & Consultant Analytics. Tracking fiable (GA4, Server-Side), dashboards et CRO. Je transforme vos données en décisions qui maximisent votre ROI.",
  lang = "fr"
} = Astro.props;

const siteUrl = "https://selimaidi.com";
const ogImage = `${siteUrl}/og-image.jpg`;
---

<!DOCTYPE html>
<html lang={lang}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description}>
    <meta name="keywords" content="Data Copilot, Consultant Analytics, GA4, Server-Side GTM, sGTM, Tracking, Dashboards, CRO, Performance digitale, Google Tag Manager">
    <meta name="author" content="Sélim Aïdi">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href={siteUrl}>
    
    <!-- Open Graph / LinkedIn -->
    <meta property="og:type" content="website">
    <meta property="og:url" content={siteUrl}>
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:image" content={ogImage}>
    <meta property="og:locale" content="fr_BE">
    <meta property="og:site_name" content="Sélim Aïdi">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content={siteUrl}>
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content={description}>
    <meta name="twitter:image" content={ogImage}>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- ============================================
         CONSENT MODE V2 - MUST BE BEFORE GTM
    ============================================ -->
    <script is:inline>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        
        // Default: everything denied before consent
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied',
            'functionality_storage': 'denied',
            'personalization_storage': 'denied',
            'security_storage': 'granted',
            'wait_for_update': 500
        });
        
        // Enable URL passthrough for better conversion tracking
        gtag('set', 'url_passthrough', true);
        
        // Enable ads data redaction when consent denied
        gtag('set', 'ads_data_redaction', true);
    </script>
    
    <!-- ============================================
         CMP - Cookiebot
    ============================================ -->
    <script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" 
        data-cbid="0a04937e-92a3-4525-a4a5-c13c953305af" 
        data-blockingmode="auto" 
        type="text/javascript"></script>
    
    <!-- ============================================
         GTM HEAD SCRIPT (Stape Custom Loader)
    ============================================ -->
    <script is:inline>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s);j.async=true;j.src="https://metrics.selimaidi.com/15itptlyfu.js?"+i;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','1c=HAJEKyA9WT0hNDI%2FPkQ6TwNbS0JFVhAHSBUcAB0dFQARD1cPGx0%3D');</script>
</head>
<body>
    <!-- GTM BODY NOSCRIPT -->
    <noscript><iframe src="https://metrics.selimaidi.com/ns.html?id=GTM-TTRKSJ4N"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <!-- Scroll Progress Bar -->
    <div class="scroll-progress"></div>

    <!-- Custom Cursor -->
    <div class="cursor"></div>

    <!-- Background Effects -->
    <div class="bg-effects" aria-hidden="true"></div>

    <slot />

    <!-- Global Scripts -->
    <script is:inline>
        // ==========================================
        // Scroll Progress Bar
        // ==========================================
        window.addEventListener('scroll', () => {
            const scrollProgress = document.querySelector('.scroll-progress');
            const scrollTotal = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPosition = window.scrollY;
            const progress = (scrollPosition / scrollTotal) * 100;
            if (scrollProgress) scrollProgress.style.width = progress + '%';
        });

        // ==========================================
        // Navbar scroll effect
        // ==========================================
        const nav = document.getElementById('nav');
        window.addEventListener('scroll', () => {
            if (nav) {
                if (window.scrollY > 50) {
                    nav.classList.add('scrolled');
                } else {
                    nav.classList.remove('scrolled');
                }
            }
        });

        // ==========================================
        // Custom Cursor - Instant (no lag)
        // ==========================================
        const cursor = document.querySelector('.cursor');
        
        document.addEventListener('mousemove', (e) => {
            if (cursor) {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            }
        });

        // Cursor hover effect
        const hoverElements = document.querySelectorAll('a, button, .service-card, .value-card, .trust-card');
        hoverElements.forEach(el => {
            el.addEventListener('mouseenter', () => {
                if (cursor) cursor.classList.add('hover');
            });
            el.addEventListener('mouseleave', () => {
                if (cursor) cursor.classList.remove('hover');
            });
        });

        // ==========================================
        // Magnetic Buttons
        // ==========================================
        const magneticElements = document.querySelectorAll('.magnetic');
        magneticElements.forEach(el => {
            el.addEventListener('mousemove', (e) => {
                const rect = el.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                el.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px)`;
            });
            el.addEventListener('mouseleave', () => {
                el.style.transform = 'translate(0, 0)';
            });
        });

        // ==========================================
        // Card Tilt Effect
        // ==========================================
        const tiltCards = document.querySelectorAll('.tilt');
        tiltCards.forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = (y - centerY) / 10;
                const rotateY = (centerX - x) / 10;
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-10px)`;
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) translateY(0)';
            });
        });

        // ==========================================
        // Reveal on Scroll
        // ==========================================
        const revealElements = document.querySelectorAll('.reveal');
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        });
        revealElements.forEach(el => revealObserver.observe(el));

        // ==========================================
        // GTM DataLayer - Event Tracking
        // ==========================================
        document.querySelectorAll('[data-event]').forEach(element => {
            element.addEventListener('click', function(e) {
                const eventName = this.getAttribute('data-event');
                const eventLocation = this.getAttribute('data-location') || '';
                const ctaText = this.getAttribute('data-cta-text') || this.innerText.trim();
                const socialPlatform = this.getAttribute('data-social') || null;

                window.dataLayer.push({
                    'event': eventName,
                    'event_location': eventLocation,
                    'cta_text': ctaText,
                    'social_platform': socialPlatform,
                    'page_url': window.location.href,
                    'timestamp': new Date().toISOString()
                });
            });
        });

        // ==========================================
        // Smooth scroll for anchor links
        // ==========================================
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    const nav = document.getElementById('nav');
                    const headerHeight = nav ? nav.offsetHeight : 0;
                    const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - headerHeight;
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script>
</body>
</html>

<style is:global>
    /* ============================================
       CSS VARIABLES
    ============================================ */
    :root {
        --color-bg: #050505;
        --color-surface: #0a0a0a;
        --color-gold: #d4af37;
        --color-blue: #0ea5e9;
        --color-lime: #a3e635;
        --color-white: #ffffff;
        --color-gray: #737373;
        --color-border: rgba(255, 255, 255, 0.1);
        --font-display: 'Syne', sans-serif;
        --font-body: 'JetBrains Mono', monospace;
    }

    /* ============================================
       RESET & BASE
    ============================================ */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html {
        scroll-behavior: smooth;
    }

    body {
        font-family: var(--font-body);
        background: var(--color-bg);
        color: var(--color-white);
        line-height: 1.6;
        overflow-x: hidden;
        cursor: none;
    }

    /* ============================================
       SCROLL PROGRESS BAR
    ============================================ */
    .scroll-progress {
        position: fixed;
        top: 0;
        left: 0;
        width: 0%;
        height: 3px;
        background: linear-gradient(90deg, var(--color-gold) 0%, var(--color-blue) 100%);
        z-index: 10001;
        transition: width 0.1s ease;
    }

    /* ============================================
       CUSTOM CURSOR
    ============================================ */
    .cursor {
        width: 20px;
        height: 20px;
        border: 2px solid var(--color-gold);
        border-radius: 50%;
        position: fixed;
        pointer-events: none;
        z-index: 10000;
        mix-blend-mode: difference;
        transform: translate(-50%, -50%);
        transition: width 0.2s ease, height 0.2s ease, border-color 0.2s ease;
    }

    .cursor.hover {
        width: 35px;
        height: 35px;
        border-color: var(--color-blue);
    }  

    /* ============================================
       BACKGROUND EFFECTS
    ============================================ */
    .bg-effects {
        position: fixed;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 80% 80%, rgba(14, 165, 233, 0.1) 0%, transparent 50%);
        animation: gradientMove 15s ease infinite;
        z-index: -1;
        pointer-events: none;
    }

    @keyframes gradientMove {
        0%, 100% { transform: translate(0, 0); }
        50% { transform: translate(-5%, -5%); }
    }

    /* ============================================
       GRADIENT ANIMATION
    ============================================ */
    @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    /* ============================================
       REVEAL ANIMATION
    ============================================ */
    .reveal {
        opacity: 0;
        transform: translateY(50px);
        transition: opacity 0.8s ease, transform 0.8s ease;
    }

    .reveal.active {
        opacity: 1;
        transform: translateY(0);
    }

    /* ============================================
       RESPONSIVE - Disable cursor on mobile
    ============================================ */
    @media (max-width: 1024px) {
        body {
            cursor: auto;
        }
        .cursor {
            display: none;
        }
    }
</style>